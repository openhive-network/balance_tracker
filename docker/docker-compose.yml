version: '3.9'
services:
  haf:
    image: ${HAF_REGISTRY:-hiveio/haf}:${HAF_VERSION:-v1.27.4.0}
    entrypoint:
      - /home/haf_admin/docker_entrypoint.sh
      - --shared-file-size=1G --plugin database_api --replay --stop-replay-at-block=5000000
    environment:
      HIVED_UID:
      PG_ACCESS: "
        host    haf_block_log    haf_app_admin    all    trust\n
        host    haf_block_log    haf_admin        all    trust\n
        host    postgres    haf_admin        all    trust\n
        "
    volumes:
      - haf_datadir:/home/hived/datadir
      - haf_shmdir:/home/hived/shm_dir
      - ./haf/config_5M.ini:/home/hived/datadir/config.ini
      - ./blockchain:/home/hived/datadir/blockchain
    networks:
      haf-network:
    healthcheck:
      test: ["CMD-SHELL","curl -f localhost:8090"]
      interval: 60s
      timeout: 60s
      retries: 15
      start_period: 30s

networks:
  haf-network:

volumes:
  haf_datadir:
    driver: local
  haf_shmdir:
    driver: local